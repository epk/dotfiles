{{ if eq .chezmoi.os "darwin" }}
# Homebrew
[[ -x /opt/homebrew/bin/brew ]] && eval "$(/opt/homebrew/bin/brew shellenv)"
BREW_PREFIX="${HOMEBREW_PREFIX:-/opt/homebrew}"
{{ end }}

# shellcheck disable=SC2034
DEFAULT_USER=$USER

export GOPATH=$HOME
export EDITOR=nano
export PATH=$HOME/.npm-global/bin:$GOPATH/bin:$HOME/.krew/bin:/usr/local/sbin:$PATH

# Completions
autoload -Uz compinit
compinit

{{ if eq .chezmoi.os "darwin" }}
# Plugins via Homebrew
source "$BREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
source "$BREW_PREFIX/share/zsh-fast-syntax-highlighting/fast-syntax-highlighting.plugin.zsh"
source "$BREW_PREFIX/share/zsh-history-substring-search/zsh-history-substring-search.zsh"
source "$BREW_PREFIX/share/zsh-you-should-use/you-should-use.plugin.zsh"
{{ end }}

# fzf keybindings + completion
eval "$(fzf --zsh)"

{{ if eq .chezmoi.os "darwin" }}
# GCloud SDK
# shellcheck disable=SC1091
if [ -f "$BREW_PREFIX/Caskroom/gcloud-cli/latest/google-cloud-sdk/path.zsh.inc" ]; then
  source "$BREW_PREFIX/Caskroom/gcloud-cli/latest/google-cloud-sdk/path.zsh.inc";
fi

# shellcheck disable=SC1091
if [ -f "$BREW_PREFIX/Caskroom/gcloud-cli/latest/google-cloud-sdk/completion.zsh.inc" ]; then
  source "$BREW_PREFIX/Caskroom/gcloud-cli/latest/google-cloud-sdk/completion.zsh.inc";
fi

eval "$(gdircolors "$HOME/.LS_COLORS")"
{{ end }}

# shellcheck disable=SC1090
for file in ~/.{aliases,functions}; do
  [ -r "$file" ] && [ -f "$file" ] && source "$file";
done;

export KUBECONFIG=$HOME/.kube/config

{{ if .isShopify -}}
export KUBECONFIG=$KUBECONFIG:$HOME/.kube/config.shopify.cloudplatform
export GOPRIVATE="github.com/Shopify/*"
[ -f /opt/dev/dev.sh ] && source /opt/dev/dev.sh
[[ -f /opt/dev/sh/chruby/chruby.sh ]] && { type chruby >/dev/null 2>&1 || chruby () { source /opt/dev/sh/chruby/chruby.sh; chruby "$@"; } }

# tec profile (sourced after Homebrew so tec tools take PATH precedence)
[[ -x {{ .chezmoi.homeDir }}/.local/state/tec/profiles/base/current/global/init ]] && eval "$({{ .chezmoi.homeDir }}/.local/state/tec/profiles/base/current/global/init zsh)"
{{ end -}}

{{ if eq .chezmoi.os "darwin" }}
eval "$(zoxide init zsh)"
{{ end }}

# Starship prompt (must be last before try)
eval "$(starship init zsh)"

# Initialize try - lightweight experiments for people with ADHD
command -v try &>/dev/null && eval "$(try init ~/src/tries)"
